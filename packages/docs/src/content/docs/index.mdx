---
title: infra
description: Personal nix-config with multi-channel resilience and directory-based autowiring
template: splash
hero:
  tagline: Reproducible system configurations for macOS and NixOS. Multi-channel nixpkgs resilience with directory-based autowiring eliminates boilerplate and handles breakage gracefully.
  image:
    file: ../../assets/nix-snowflake-colours.svg
  actions:
    - text: Getting started
      link: /guides/getting-started/
      icon: right-arrow
      variant: primary
    - text: View on GitHub
      link: https://github.com/cameronraysmith/infra
      icon: external
      variant: minimal
---

import { Card, CardGrid } from "@astrojs/starlight/components";

## Features

<CardGrid stagger>
  <Card title="Directory-based autowiring" icon="puzzle">
    Add a file, get a flake output. nixos-unified eliminates manual wiring in flake.nix.
    File paths become configurations automatically.
  </Card>
  <Card title="Multi-channel resilience" icon="shield">
    Surgical fixes for nixpkgs breakage without full rollbacks.
    Stable fallbacks, upstream patches, and build overrides.
  </Card>
  <Card title="Platform support" icon="laptop">
    macOS via nix-darwin, Linux via NixOS, standalone home-manager.
    Consistent configuration across all platforms.
  </Card>
  <Card title="Multi-user patterns" icon="user">
    Admin users with integrated home-manager. Non-admin users with standalone configs.
    Multiple users per host supported.
  </Card>
  <Card title="Secrets management" icon="lock">
    SOPS with age encryption for secure secrets.
    Git-committed encrypted secrets with key rotation support.
  </Card>
  <Card title="Proven patterns" icon="approve-check">
    Built on flake-parts, nixos-unified, and mirkolenz resilience patterns.
    Standing on the shoulders of giants.
  </Card>
</CardGrid>

## Quick start

```bash
# Bootstrap nix and essential tools
make bootstrap && exec $SHELL

# Clone repository
git clone https://github.com/cameronraysmith/infra.git
cd infra

# Activate direnv
direnv allow

# Activate configuration
just activate
```

See [Getting started guide](/guides/getting-started/) for complete setup instructions.

## Architecture

This nix-config combines three complementary architectural patterns:

1. **flake-parts** - Modular flake composition framework
2. **nixos-unified** - Directory-based autowiring eliminates boilerplate
3. **mirkolenz patterns** - Multi-channel nixpkgs resilience for handling breakage

When nixpkgs unstable breaks, apply surgical fixes (stable fallback for one package) without rolling back your entire flake.lock.

Learn more in [Nix-Config Architecture](/concepts/nix-config-architecture/).

## Documentation structure

- **Guides** - Task-oriented how-tos for common operations
- **Concepts** - Understanding-oriented explanations of architecture and patterns
- **Reference** - Information-oriented lookup material
- **Development** - AMDiRE-based development documentation

## Next steps

<CardGrid>
  <Card title="Understand the architecture" icon="open-book">
    Learn about the three-layer design combining flake-parts, nixos-unified, and multi-channel resilience.
    [Nix-Config Architecture →](/concepts/nix-config-architecture/)
  </Card>
  <Card title="Add a new host" icon="laptop">
    Onboard a new macOS or NixOS system with this configuration.
    [Host onboarding guide →](/guides/host-onboarding/)
  </Card>
  <Card title="Configure secrets" icon="lock">
    Set up SOPS for encrypted secrets management with age encryption.
    [Secrets management guide →](/guides/secrets-management/)
  </Card>
  <Card title="Handle breakage" icon="warning">
    Learn the systematic workflow for addressing nixpkgs unstable breakage.
    [Incident response →](/guides/nixpkgs-incident-response/)
  </Card>
</CardGrid>
