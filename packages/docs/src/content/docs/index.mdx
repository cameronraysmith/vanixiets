---
title: infra
description: Personal nix-config with multi-channel resilience and directory-based autowiring
template: splash
hero:
  tagline: Reproducible system configurations for macOS and NixOS. Multi-channel nixpkgs resilience with directory-based autowiring eliminates boilerplate and handles breakage gracefully.
  image:
    file: ../../assets/nix-snowflake-colours.svg
  actions:
    - text: Getting started
      link: /guides/getting-started/
      icon: right-arrow
      variant: primary
    - text: View on GitHub
      link: https://github.com/cameronraysmith/infra
      icon: external
      variant: minimal
---

import { Card, CardGrid } from "@astrojs/starlight/components";

## Features

<CardGrid stagger>
  <Card title="Directory-based autowiring" icon="puzzle">
    nixos-unified scans filesystem structure to automatically generate flake outputs.
    Configurations map to darwinConfigurations/nixosConfigurations/homeConfigurations.
    Modules map to flakeModules/darwinModules/nixosModules, overlays to overlays.*.
  </Card>
  <Card title="Per-package nixpkgs channel selection" icon="shield">
    Multi-channel overlay architecture enables unstable default with selective stable fallbacks via overlays/infra/hotfixes.nix.
    Apply surgical fixes for broken packages without requiring full flake.lock rollback affecting O(10^5) packages.
  </Card>
  <Card title="Cross-platform deployment targets" icon="laptop">
    Deploy to NixOS, nix-darwin, or home-manager configurations.
    Consistent architecture across Linux and macOS systems with platform-specific modules.
  </Card>
  <Card title="Multi-user configuration patterns" icon="user">
    Admin users with integrated system/home-manager configurations.
    Non-admin users with standalone home-manager deployments.
  </Card>
  <Card title="Declarative secrets management" icon="lock">
    sops-nix integration with age encryption for managing encrypted secrets.
    Git-committed encrypted secrets with declarative key rotation support.
  </Card>
  <Card title="Composable package overlays" icon="puzzle">
    Layered overlay composition: multi-channel access → hotfixes → custom packages → build overrides → flake input overlays.
    Five-layer architecture for package customization and dependency management.
  </Card>
  <Card title="Reproducible development environments" icon="seti:config">
    Nix development shell with direnv activation and just task runner.
    Hermetic builds with declarative development dependencies.
  </Card>
</CardGrid>

## Quick start

```bash
# Clone repository
git clone https://github.com/cameronraysmith/infra.git
cd infra

# Bootstrap nix and essential tools
make bootstrap && exec $SHELL

# Activate direnv
direnv allow

# Activate configuration
just activate
```

See [Getting started guide](/guides/getting-started/) for complete setup instructions.

## Architecture

This nix-config combines three complementary architectural patterns:

1. **flake-parts** - Modular flake composition framework
2. **nixos-unified** - Directory-based autowiring eliminates boilerplate
3. **mirkolenz patterns** - Multi-channel nixpkgs resilience for handling breakage

When nixpkgs unstable breaks, apply surgical fixes (stable fallback for one package) without rolling back your entire flake.lock.

Learn more in [Nix-Config Architecture](/concepts/nix-config-architecture/).

## Documentation structure

- **Guides** - Task-oriented how-tos for common operations
- **Concepts** - Understanding-oriented explanations of architecture and patterns
- **Reference** - Information-oriented lookup material
- **Development** - AMDiRE-based development documentation

## Next steps

<CardGrid>
  <Card title="Understand the architecture" icon="open-book">
    Learn about the three-layer design combining flake-parts, nixos-unified, and multi-channel resilience.
    [Nix-Config Architecture →](/concepts/nix-config-architecture/)
  </Card>
  <Card title="Add a new host" icon="laptop">
    Onboard a new macOS or NixOS system with this configuration.
    [Host onboarding guide →](/guides/host-onboarding/)
  </Card>
  <Card title="Configure secrets" icon="lock">
    Set up SOPS for encrypted secrets management with age encryption.
    [Secrets management guide →](/guides/secrets-management/)
  </Card>
  <Card title="Handle broken packages" icon="warning">
    Learn the systematic workflow for addressing nixpkgs unstable breakage.
    [Handling broken packages →](/guides/handling-broken-packages/)
  </Card>
</CardGrid>
