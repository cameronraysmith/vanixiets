<story-context id="story-2.6-stibnite-config-migration" v="1.0">
  <metadata>
    <epicId>2</epicId>
    <storyId>6</storyId>
    <title>Stibnite config migration</title>
    <status>drafted</status>
    <generatedAt>2025-11-24</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/notes/development/work-items/2-6-stibnite-config-migration.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>system administrator</asA>
    <iWant>create stibnite darwin configuration in infra using blackphos as structural template</iWant>
    <soThat>my primary development workstation uses validated dendritic+clan architecture with full crs58 configuration</soThat>
    <tasks>
      <task id="1" title="Configuration Diff Analysis" acs="AC1,AC6">
        <subtask>Review blackphos config structure (modules/machines/darwin/blackphos/default.nix - 217 lines)</subtask>
        <subtask>Review zerotier darwin pattern (modules/machines/darwin/blackphos/_zerotier.nix - 100 lines)</subtask>
        <subtask>Document required modifications for stibnite (single user, hostname changes)</subtask>
        <subtask>Verify crs58 UID (502) and SSH key</subtask>
      </task>
      <task id="2" title="Create Directory Structure" acs="AC1">
        <subtask>Create modules/machines/darwin/stibnite/ directory</subtask>
        <subtask>Copy _zerotier.nix from blackphos</subtask>
        <subtask>Create default.nix with stibnite-specific configuration</subtask>
      </task>
      <task id="3" title="Implement stibnite Configuration" acs="AC1,AC3,AC4,AC6">
        <subtask>Copy blackphos/default.nix as starting point</subtask>
        <subtask>Change networking.hostName to "stibnite"</subtask>
        <subtask>Change networking.computerName to "stibnite"</subtask>
        <subtask>Remove raquel user configuration (lines 128-137 in blackphos)</subtask>
        <subtask>Remove raquel from users.knownUsers</subtask>
        <subtask>Remove raquel home-manager imports (lines 194-214 in blackphos)</subtask>
        <subtask>Verify crs58 imports include AI aggregate</subtask>
        <subtask>Configure machine-specific homebrew casks (include zerotier-one)</subtask>
        <subtask>Verify documentation overrides present</subtask>
        <subtask>Verify system.stateVersion = 4</subtask>
      </task>
      <task id="4" title="Register in Clan Inventory" acs="AC2,AC5">
        <subtask>Add stibnite to modules/clan/machines.nix</subtask>
        <subtask>Add stibnite to modules/clan/inventory/machines.nix</subtask>
        <subtask>Verify clan recognizes stibnite (clan machines list)</subtask>
      </task>
      <task id="5" title="Build Validation" acs="AC2,AC3">
        <subtask>Execute nix build .#darwinConfigurations.stibnite.system</subtask>
        <subtask>Verify exit code 0 and ./result symlink created</subtask>
        <subtask>Execute nix build .#homeConfigurations.aarch64-darwin.crs58.activationPackage</subtask>
        <subtask>Compare derivation count to blackphos crs58</subtask>
      </task>
      <task id="6" title="Configuration Evaluation" acs="AC5">
        <subtask>Execute nix eval .#darwinConfigurations.stibnite.config.system.build.toplevel --json</subtask>
        <subtask>Verify no errors and JSON output received</subtask>
        <subtask>Check for evaluation warnings</subtask>
      </task>
      <task id="7" title="Documentation and Commit" acs="AC7">
        <subtask>Complete Dev Notes with implementation results</subtask>
        <subtask>Document single-user darwin pattern</subtask>
        <subtask>Add references to Story 2.5</subtask>
        <subtask>Document Story 2.7 handoff guidance</subtask>
        <subtask>Update sprint-status.yaml</subtask>
        <subtask>Commit implementation changes atomically</subtask>
      </task>
    </tasks>
  </story>

  <acceptanceCriteria>
    <criterion id="AC1" title="stibnite Directory Structure Created">
      <description>Create stibnite darwin module directory with all required files</description>
      <verification>
        <command>ls -la modules/machines/darwin/stibnite/</command>
        <expected>default.nix, _zerotier.nix files exist</expected>
        <command>wc -l modules/machines/darwin/stibnite/default.nix</command>
        <expected>~185-190 lines (vs blackphos 217 - single user)</expected>
        <command>diff modules/machines/darwin/blackphos/_zerotier.nix modules/machines/darwin/stibnite/_zerotier.nix | head -5</command>
        <expected>Only hostname comments differ (if any)</expected>
      </verification>
    </criterion>
    <criterion id="AC2" title="Darwin Build Succeeds">
      <description>Verify stibnite darwin configuration builds without errors</description>
      <verification>
        <command>nix build .#darwinConfigurations.stibnite.system</command>
        <expected>Build succeeds, ./result symlink created, exit code 0</expected>
      </verification>
    </criterion>
    <criterion id="AC3" title="crs58 User Configuration Complete">
      <description>Verify crs58 user is fully configured with all 8 secrets and 7 aggregates</description>
      <verification>
        <command>nix build .#homeConfigurations.aarch64-darwin.crs58.activationPackage</command>
        <expected>Build succeeds (more derivations than raquel due to AI aggregate)</expected>
        <command>sops -d secrets/home-manager/users/crs58/secrets.yaml | grep -c "^[a-z]"</command>
        <expected>8 secrets</expected>
        <command>grep -E "flakeModulesHome\.(ai|core|development|packages|shell|terminal|tools)" modules/machines/darwin/stibnite/default.nix | wc -l</command>
        <expected>7 aggregates imported</expected>
      </verification>
    </criterion>
    <criterion id="AC4" title="Zerotier Darwin Integration Configured">
      <description>Verify zerotier configuration is correct for stibnite</description>
      <verification>
        <command>cat modules/machines/darwin/stibnite/_zerotier.nix | grep -E "db4344343b14b903"</command>
        <expected>Network ID present</expected>
        <command>grep -E "zerotier-one" modules/machines/darwin/stibnite/default.nix</command>
        <expected>zerotier-one in additionalCasks list</expected>
        <command>grep -E "\\./_zerotier\\.nix" modules/machines/darwin/stibnite/default.nix</command>
        <expected>Import present</expected>
      </verification>
    </criterion>
    <criterion id="AC5" title="Configuration Evaluation Succeeds">
      <description>Verify nix evaluation completes without module resolution errors</description>
      <verification>
        <command>nix eval .#darwinConfigurations.stibnite.config.system.build.toplevel --json 2>&amp;1 | head -c 200</command>
        <expected>JSON output with /nix/store path, no errors</expected>
      </verification>
    </criterion>
    <criterion id="AC6" title="Darwin-Specific Features Validated">
      <description>Verify darwin-specific configuration settings are correct</description>
      <verification>
        <command>grep -E "aarch64-darwin" modules/machines/darwin/stibnite/default.nix</command>
        <expected>nixpkgs.hostPlatform = "aarch64-darwin"</expected>
        <command>grep -E 'networking.hostName.*"stibnite"' modules/machines/darwin/stibnite/default.nix</command>
        <expected>networking.hostName = "stibnite"</expected>
        <command>grep -E "primaryUser.*crs58" modules/machines/darwin/stibnite/default.nix</command>
        <expected>system.primaryUser = "crs58"</expected>
        <command>grep -E "touchIdAuth.*true" modules/machines/darwin/stibnite/default.nix</command>
        <expected>security.pam.services.sudo_local.touchIdAuth = true</expected>
        <command>grep -E "MaxAuthTries" modules/machines/darwin/stibnite/default.nix</command>
        <expected>MaxAuthTries 20</expected>
        <command>grep -E "programs.zsh.enable.*true" modules/machines/darwin/stibnite/default.nix</command>
        <expected>programs.zsh.enable = true</expected>
        <command>grep -E "documentation.enable.*true" modules/machines/darwin/stibnite/default.nix</command>
        <expected>documentation.enable = true</expected>
        <command>grep -E "users.raquel" modules/machines/darwin/stibnite/default.nix</command>
        <expected>No matches (single user stibnite)</expected>
      </verification>
    </criterion>
    <criterion id="AC7" title="Documentation Complete for Story 2.7 Handoff">
      <description>Document implementation results and prepare for Story 2.7</description>
      <deliverables>
        <deliverable>Story Dev Notes with implementation patterns</deliverable>
        <deliverable>Reference links to Story 2.5 (blackphos template source)</deliverable>
        <deliverable>Single-user darwin pattern documented for future reference</deliverable>
        <deliverable>Explicit guidance for Story 2.7 on simultaneous activation</deliverable>
      </deliverables>
    </criterion>
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc>
        <path>docs/notes/development/epics/epic-2-infrastructure-architecture-migration.md</path>
        <title>Epic 2: Infrastructure Architecture Migration</title>
        <section>Story 2.6: Stibnite config migration (lines 157-176)</section>
        <snippet>Apply dendritic+clan architecture to stibnite using blackphos as structural template. Preserve all stibnite-specific packages and services. Validate nix-darwin build success.</snippet>
      </doc>
      <doc>
        <path>docs/notes/development/architecture/darwin-networking-options.md</path>
        <title>Darwin Networking Options</title>
        <section>Option 1: Homebrew Zerotier (VALIDATED)</section>
        <snippet>Option 1 validated for production use in Epic 1 Story 1.12. Zerotier network db4344343b14b903. Homebrew cask + activation script pattern.</snippet>
      </doc>
      <doc>
        <path>docs/notes/development/work-items/2-5-blackphos-config-migration-to-infra.md</path>
        <title>Story 2.5: Blackphos config migration to infra</title>
        <section>Dev Notes - Zerotier Darwin Pattern</section>
        <snippet>Pattern validated in Epic 1 Story 1.12. Homebrew cask, activation script join network, network ID db4344343b14b903. Copy _zerotier.nix pattern to stibnite.</snippet>
      </doc>
      <doc>
        <path>docs/notes/development/sprint-status.yaml</path>
        <title>Sprint Status</title>
        <section>Story 2.6</section>
        <snippet>story-2-6: drafted, story-2-6-title: "Stibnite config migration". Phase 2 Active Darwin Workstations.</snippet>
      </doc>
      <doc>
        <path>CLAUDE.md</path>
        <title>Project README</title>
        <section>Machine Fleet - stibnite</section>
        <snippet>stibnite: nix-darwin laptop, Primary User: crs58, Admin User: crs58. crs58's primary workstation.</snippet>
      </doc>
    </docs>
    <code>
      <artifact>
        <path>modules/machines/darwin/blackphos/default.nix</path>
        <kind>darwin-module</kind>
        <symbol>flake.modules.darwin."machines/darwin/blackphos"</symbol>
        <lines>1-217</lines>
        <reason>PRIMARY TEMPLATE: Structural template for stibnite. Shows dual-user pattern (crs58+raquel), homebrew config, TouchID, MaxAuthTries, zsh, documentation. Stibnite will simplify to single user (crs58 only).</reason>
      </artifact>
      <artifact>
        <path>modules/machines/darwin/blackphos/_zerotier.nix</path>
        <kind>darwin-module</kind>
        <symbol>zerotierJoinScript</symbol>
        <lines>1-100</lines>
        <reason>COPY DIRECTLY: Zerotier darwin pattern with network ID db4344343b14b903. Copy to stibnite/_zerotier.nix unchanged (or with minimal comment edits).</reason>
      </artifact>
      <artifact>
        <path>modules/home/users/crs58/default.nix</path>
        <kind>home-manager-module</kind>
        <symbol>flake.modules.homeManager."users/crs58"</symbol>
        <lines>1-71</lines>
        <reason>EXISTS - will be imported for stibnite. Contains 8 secrets (github-token, ssh-signing-key, ssh-public-key, glm-api-key, firecrawl-api-key, huggingface-token, bitwarden-email, atuin-key). Pattern A with sops.templates.allowed_signers.</reason>
      </artifact>
      <artifact>
        <path>modules/home/configurations.nix</path>
        <kind>flake-parts-module</kind>
        <symbol>mkHomeConfig</symbol>
        <lines>1-93</lines>
        <reason>Shows aggregate import pattern for homeConfigurations. crs58 gets all aggregates including AI. Pattern A multi-aggregate organization.</reason>
      </artifact>
      <artifact>
        <path>modules/clan/machines.nix</path>
        <kind>clan-config</kind>
        <symbol>clan.machines</symbol>
        <lines>1-24</lines>
        <reason>ADD STIBNITE: Copy blackphos pattern (line 20-22) for stibnite. Pattern: imports = [ config.flake.modules.darwin."machines/darwin/stibnite" ]</reason>
      </artifact>
      <artifact>
        <path>modules/clan/inventory/machines.nix</path>
        <kind>clan-inventory</kind>
        <symbol>clan.inventory.machines</symbol>
        <lines>1-52</lines>
        <reason>ADD STIBNITE: Copy blackphos pattern (lines 42-50) for stibnite. Tags: darwin, workstation, laptop. Description: crs58's primary workstation.</reason>
      </artifact>
      <artifact>
        <path>secrets/home-manager/users/crs58/secrets.yaml</path>
        <kind>sops-secrets</kind>
        <symbol>crs58-secrets</symbol>
        <lines>all</lines>
        <reason>8 secrets already encrypted with infra age keys from Story 2.4. No changes needed - stibnite will use existing crs58 secrets.</reason>
      </artifact>
    </code>
    <dependencies>
      <ecosystem name="nix">
        <package>nixpkgs</package>
        <package>home-manager</package>
        <package>nix-darwin</package>
        <package>clan-core</package>
        <package>sops-nix</package>
        <package>srvos</package>
        <package>lazyvim-nix</package>
        <package>nix-index-database</package>
      </ecosystem>
      <ecosystem name="homebrew">
        <package>zerotier-one (cask)</package>
        <package>docker-desktop (cask, likely)</package>
        <package>gpg-suite (cask, likely)</package>
      </ecosystem>
    </dependencies>
  </artifacts>

  <constraints>
    <constraint source="Epic 2 Definition">stibnite must use blackphos as structural template - dendritic+clan architecture pattern</constraint>
    <constraint source="CLAUDE.md">stibnite is crs58's PRIMARY workstation (single user: crs58 only)</constraint>
    <constraint source="Story 2.5">Zerotier darwin uses Option 1: Homebrew cask + activation script (validated)</constraint>
    <constraint source="Architecture">Pattern A aggregates: crs58 gets all 7 aggregates including AI</constraint>
    <constraint source="Story 2.5 Migration Gap">Verify Story 2.3 migration is complete - check modules/home/packages/ exists</constraint>
    <constraint source="Darwin">system.stateVersion = 4 (matching infra/blackphos)</constraint>
    <constraint source="Darwin">crs58 UID = 502, home = /Users/crs58</constraint>
    <constraint source="Security">SSH MaxAuthTries 20 (Bitwarden agent workaround)</constraint>
    <constraint source="Security">TouchID sudo enabled for laptop convenience</constraint>
    <constraint source="Zerotier">Network ID: db4344343b14b903 (cinnabar controller)</constraint>
  </constraints>

  <interfaces>
    <interface>
      <name>darwinConfigurations.stibnite</name>
      <kind>nix-flake-output</kind>
      <signature>darwinConfigurations.stibnite.system (nix-darwin system derivation)</signature>
      <path>flake.nix (auto-generated via clan.machines)</path>
    </interface>
    <interface>
      <name>homeConfigurations.aarch64-darwin.crs58</name>
      <kind>nix-flake-output</kind>
      <signature>homeConfigurations.aarch64-darwin.crs58.activationPackage (home-manager derivation)</signature>
      <path>modules/home/configurations.nix</path>
    </interface>
    <interface>
      <name>clan.machines.stibnite</name>
      <kind>clan-machine-registration</kind>
      <signature>imports = [ config.flake.modules.darwin."machines/darwin/stibnite" ]</signature>
      <path>modules/clan/machines.nix</path>
    </interface>
    <interface>
      <name>clan.inventory.machines.stibnite</name>
      <kind>clan-inventory-entry</kind>
      <signature>{ tags, machineClass, description }</signature>
      <path>modules/clan/inventory/machines.nix</path>
    </interface>
    <interface>
      <name>flake.modules.darwin."machines/darwin/stibnite"</name>
      <kind>dendritic-module</kind>
      <signature>darwin module with home-manager integration</signature>
      <path>modules/machines/darwin/stibnite/default.nix</path>
    </interface>
  </interfaces>

  <tests>
    <standards>
      This is an IMPLEMENTATION story creating new configuration files. Validation follows empirical testing approach: build commands verify configuration correctness, grep commands verify structural requirements. No unit tests required - nix build serves as integration test. Test pattern established in Story 2.5 (blackphos validation).
    </standards>
    <locations>
      <location>Verification commands in AC1-AC6 (in story file and this context)</location>
      <location>nix build .#darwinConfigurations.stibnite.system</location>
      <location>nix build .#homeConfigurations.aarch64-darwin.crs58.activationPackage</location>
      <location>nix eval .#darwinConfigurations.stibnite.config.system.build.toplevel --json</location>
    </locations>
    <ideas>
      <idea ac="AC1">Verify directory structure with ls and wc -l commands</idea>
      <idea ac="AC1">Diff _zerotier.nix files to confirm identical zerotier config</idea>
      <idea ac="AC2">Build darwin configuration and verify result symlink</idea>
      <idea ac="AC3">Build crs58 home-manager and compare derivation count</idea>
      <idea ac="AC3">Verify all 8 crs58 secrets decrypt successfully</idea>
      <idea ac="AC3">Grep for 7 aggregate imports in stibnite config</idea>
      <idea ac="AC4">Verify zerotier network ID db4344343b14b903 present</idea>
      <idea ac="AC4">Verify zerotier-one in additionalCasks</idea>
      <idea ac="AC5">Evaluate config and verify JSON output with no errors</idea>
      <idea ac="AC6">Verify all darwin features: platform, hostname, primaryUser, TouchID, MaxAuthTries, zsh, documentation</idea>
      <idea ac="AC6">Verify NO raquel user configuration (single user)</idea>
      <idea ac="AC7">Verify Dev Notes complete with Story 2.5 references</idea>
    </ideas>
  </tests>

  <implementationGuide>
    <phase title="Analysis">
      <step>Read blackphos/default.nix (217 lines) to understand dual-user pattern</step>
      <step>Read blackphos/_zerotier.nix (100 lines) to understand zerotier darwin pattern</step>
      <step>Identify lines to remove: raquel user (128-137), raquel knownUsers (143), raquel home-manager (194-214)</step>
      <step>Verify crs58 module exists at modules/home/users/crs58/default.nix</step>
    </phase>
    <phase title="Implementation">
      <step>mkdir -p modules/machines/darwin/stibnite</step>
      <step>cp modules/machines/darwin/blackphos/_zerotier.nix modules/machines/darwin/stibnite/</step>
      <step>cp modules/machines/darwin/blackphos/default.nix modules/machines/darwin/stibnite/</step>
      <step>Edit stibnite/default.nix: Change module name from "machines/darwin/blackphos" to "machines/darwin/stibnite"</step>
      <step>Edit stibnite/default.nix: Change networking.hostName and networking.computerName to "stibnite"</step>
      <step>Edit stibnite/default.nix: Remove users.users.raquel block (lines 128-137)</step>
      <step>Edit stibnite/default.nix: Update users.knownUsers to [ "crs58" ] only</step>
      <step>Edit stibnite/default.nix: Remove home-manager.users.raquel block (lines 194-214)</step>
      <step>Edit stibnite/default.nix: Verify crs58 imports include all 7 aggregates (ai, core, development, packages, shell, terminal, tools)</step>
      <step>Edit stibnite/default.nix: Update additionalCasks if needed (keep zerotier-one, adjust others based on stibnite needs)</step>
    </phase>
    <phase title="Clan Registration">
      <step>Add to modules/clan/machines.nix: stibnite = { imports = [ config.flake.modules.darwin."machines/darwin/stibnite" ]; }</step>
      <step>Add to modules/clan/inventory/machines.nix: stibnite = { tags = [ "darwin" "workstation" "laptop" ]; machineClass = "darwin"; description = "crs58's primary workstation"; }</step>
    </phase>
    <phase title="Validation">
      <step>nix build .#darwinConfigurations.stibnite.system</step>
      <step>nix build .#homeConfigurations.aarch64-darwin.crs58.activationPackage</step>
      <step>nix eval .#darwinConfigurations.stibnite.config.system.build.toplevel --json</step>
      <step>Run all AC verification commands</step>
    </phase>
    <phase title="Documentation">
      <step>Update story file Dev Notes with implementation evidence</step>
      <step>Document single-user darwin pattern</step>
      <step>Add Story 2.7 handoff guidance</step>
      <step>Update sprint-status.yaml: story-2-6: drafted -> in-progress -> review</step>
    </phase>
  </implementationGuide>

  <keyDifferences title="blackphos to stibnite">
    <difference>
      <component>User Count</component>
      <blackphos>2 users (crs58 admin + raquel primary)</blackphos>
      <stibnite>1 user (crs58 only - both admin AND primary)</stibnite>
    </difference>
    <difference>
      <component>Hostname</component>
      <blackphos>networking.hostName = "blackphos"</blackphos>
      <stibnite>networking.hostName = "stibnite"</stibnite>
    </difference>
    <difference>
      <component>ComputerName</component>
      <blackphos>networking.computerName = "blackphos"</blackphos>
      <stibnite>networking.computerName = "stibnite"</stibnite>
    </difference>
    <difference>
      <component>knownUsers</component>
      <blackphos>[ "crs58" "raquel" ]</blackphos>
      <stibnite>[ "crs58" ]</stibnite>
    </difference>
    <difference>
      <component>Home-Manager Users</component>
      <blackphos>users.crs58 + users.raquel blocks</blackphos>
      <stibnite>users.crs58 block only</stibnite>
    </difference>
    <difference>
      <component>Aggregates (crs58)</component>
      <blackphos>All 7 aggregates including AI</blackphos>
      <stibnite>All 7 aggregates including AI (same)</stibnite>
    </difference>
    <difference>
      <component>Line Count</component>
      <blackphos>217 lines</blackphos>
      <stibnite>~185-190 lines (25-30 lines shorter)</stibnite>
    </difference>
    <difference>
      <component>Secrets</component>
      <blackphos>crs58 (8) + raquel (5)</blackphos>
      <stibnite>crs58 (8) only</stibnite>
    </difference>
    <difference>
      <component>Zerotier</component>
      <blackphos>_zerotier.nix with db4344343b14b903</blackphos>
      <stibnite>_zerotier.nix with db4344343b14b903 (same)</stibnite>
    </difference>
  </keyDifferences>

  <predecessorContext title="Story 2.5 Key Learnings">
    <learning>Story 2.3 migration gap discovered - modules/home/packages/ was missing. FIXED in Story 2.5.</learning>
    <learning>Zerotier darwin pattern validated: homebrew cask + activation script with network ID db4344343b14b903</learning>
    <learning>Package validation approach: use store paths counts (transitive closure) vs derivation counts</learning>
    <learning>Darwin system: 1930 store paths, raquel HM: 505 store paths (Story 2.5 baseline)</learning>
    <learning>All 7 ACs validated with empirical evidence - provides template for Story 2.6 validation</learning>
    <learning>crs58 module ready at modules/home/users/crs58/default.nix with 8 secrets</learning>
  </predecessorContext>

  <singleUserDarwinPattern>
    <description>Pattern for single-user darwin configuration (vs blackphos dual-user)</description>
    <code>
# Single-user darwin configuration pattern (stibnite)
users.users.crs58 = {
  uid = 502;
  home = "/Users/crs58";
  shell = pkgs.zsh;
  description = "crs58";
  openssh.authorizedKeys.keys = [ "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAINdO9rInDa9HvdtZZxmkgeEdAlTupCy3BgA/sqSGyUH+" ];
};

users.knownUsers = [ "crs58" ];  # Single user only

home-manager = {
  # ... global settings ...
  users.crs58.imports = [
    flakeModulesHome."users/crs58"
    flakeModulesHome.base-sops
    # ALL 7 aggregates for crs58 (including AI)
    flakeModulesHome.ai          # crs58-specific (not in raquel)
    flakeModulesHome.core
    flakeModulesHome.development
    flakeModulesHome.packages
    flakeModulesHome.shell
    flakeModulesHome.terminal
    flakeModulesHome.tools
    # Additional modules...
  ];
  # NO users.raquel block (single user)
};
    </code>
  </singleUserDarwinPattern>

  <validationCommands>
    <command purpose="Darwin build">nix build .#darwinConfigurations.stibnite.system</command>
    <command purpose="Home-manager build">nix build .#homeConfigurations.aarch64-darwin.crs58.activationPackage</command>
    <command purpose="Configuration evaluation">nix eval .#darwinConfigurations.stibnite.config.system.build.toplevel --json</command>
    <command purpose="Secrets decryption test">sops -d secrets/home-manager/users/crs58/secrets.yaml</command>
    <command purpose="Clan machine list">clan machines list | grep stibnite</command>
    <command purpose="Zerotier network ID check">grep db4344343b14b903 modules/machines/darwin/stibnite/_zerotier.nix</command>
  </validationCommands>
</story-context>
