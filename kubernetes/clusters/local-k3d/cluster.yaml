# ctlptl cluster configuration for local k3d development cluster
# This configuration creates a single-node k3d cluster (k3s v1.31) with:
# - Disabled Flannel (for Cilium CNI)
# - Disabled kube-proxy (for Cilium kube-proxy replacement)
# - Disabled Traefik and ServiceLB (using custom ingress setup)
# - Port 30080 exposed for ArgoCD access via NodePort
# - K3D_FIX_MOUNTS=1 environment variable for OrbStack compatibility
apiVersion: ctlptl.dev/v1alpha1
kind: Cluster
name: k3d-dev
product: k3d
k3d:
  v1alpha5Simple:
    servers: 1
    image: rancher/k3s:v1.31.4-k3s1
    env:
      - envVar: K3D_FIX_MOUNTS=1
        nodeFilters:
          - server:*
          - agent:*
    ports:
      - port: 30080:30080
        nodeFilters:
          - loadbalancer
    options:
      k3s:
        extraArgs:
          - arg: --flannel-backend=none
            nodeFilters:
              - server:*
          - arg: --disable-network-policy
            nodeFilters:
              - server:*
          - arg: --disable=traefik
            nodeFilters:
              - server:*
          - arg: --disable=servicelb
            nodeFilters:
              - server:*
